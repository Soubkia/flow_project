% material properties
k  = 1;        % thermal conductivity
D  = k*eye(2); % conduction matrix

% mesh specifications
nsd  = 2;         % number of space dimensions
nnp  = 323;     % number of nodal nodes
nel  = 556;     % number of elements
nen  = 3;         % number of element nodes 
ndof = 1;         % degrees-of-freedom per node
neq  = nnp*ndof;  % number of equations


f = zeros(neq,1);         % initialize nodal flux vector
d = zeros(neq,1);         % initialize nodal temperature vector vector
K = zeros(neq);           % initialize stiffness matrix

flags = zeros(neq,1);     % array to set B.C flags 
e_bc  = zeros(neq,1);     % essential B.C array
n_bc  = zeros(neq,1);     % natural B.C array
P     = zeros(neq,1);     % initialize point source defined at a node 
s     = 6*ones(nen,nel);  % constant heat source defined over the nodes

ngp    = 2;           % number of gauss points in each direction

% essential BCs
nd   = 1;              % number of nodes on essential boundary
flags   = [0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];        % value is 2 if node is essential
e_bc = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];            % array of values alond e_bc


% what to plot
compute_flux = 'yes';
plot_mesh    = 'yes';
plot_nod     = 'yes';
plot_temp    = 'yes';
plot_flux    = 'yes';


% natural BC - defined on edges positioned on natural boundary
n_bc  = [35 34 33 32 3 64 63 62 61 8 10 75 76 79 77 78 5 101 102 105 103 104
5 35 34 33 32 10 64 63 62 61 75 76 77 11 78 79 101 102 103 16 104 105
1 1 1 1 1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 1 1 1 1 1 1
1 1 1 1 1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 1 1 1 1 1 1]; % node 1, node 2, value 1, value 2
        
nbe = 22;    % number of edges on the natural boundary


% mesh generation

x   = [0.0 0.0 5.0 0.589246213 5.0 0.0 0.0 -5.0 -0.589246213 -5.0 -5.0 -0.58926034 -1.17850661 0.58926034 1.17850661 5.0 0.0 0.0 0.0 0.0 0.416666657 0.833333313 1.25 1.66666663 2.08333325 2.5 2.91666675 3.33333325 3.75 4.16666651 4.58333349 5.0 5.0 5.0 5.0 0.294623107 4.55892467 4.11784935 3.67677379 3.23569846 2.79462314 2.35354781 1.91247237 1.47139692 1.0303216 0.0 0.0 0.0 0.0 -0.416666657 -0.833333313 -1.25 -1.66666663 -2.08333325 -2.5 -2.91666675 -3.33333325 -3.75 -4.16666651 -4.58333349 -5.0 -5.0 -5.0 -5.0 -0.294623107 -4.55892467 -4.11784935 -3.67677379 -3.23569846 -2.79462314 -2.35354781 -1.91247237 -1.47139692 -1.0303216 -5.0 -5.0 -5.0 -5.0 -5.0 -4.58333349 -4.16666651 -3.75 -3.33333325 -2.91666675 -2.5 -2.08333325 -1.66666663 -1.25 -0.833333313 -0.416666657 -0.29463017 -0.883883476 -1.17850661 -1.30054343 -0.883876383 0.29463017 0.883883476 1.17850661 1.30054343 0.883876383 5.0 5.0 5.0 5.0 5.0 4.58333349 4.16666651 3.75 3.33333325 2.91666675 2.5 2.08333325 1.66666663 1.25 0.833333313 0.416666657 0.319031835 0.343440533 0.367849231 0.392257959 0.638063669 0.686881065 0.735698462 0.784515917 1.07425725 1.11819291 1.16212869 1.20606434 1.51045096 1.54950488 1.58855879 1.62761271 1.94664454 1.98081672 2.0149889 2.0491612 2.38283825 2.41212869 2.44141912 2.47070956 2.81903172 2.84344053 2.86784935 2.89225793 3.25522542 3.27475238 3.29427934 3.3138063 3.69141912 3.70606422 3.72070956 3.73535466 4.12761259 4.13737631 4.14713955 4.15690327 4.56380653 4.56868792 4.57356977 4.57845163 -0.319031835 -0.343440533 -0.367849231 -0.392257959 -0.638063669 -0.686881065 -0.735698462 -0.784515917 -1.07425725 -1.11819291 -1.16212869 -1.20606434 -1.51045096 -1.54950488 -1.58855879 -1.62761271 -1.94664454 -1.98081672 -2.0149889 -2.0491612 -2.38283825 -2.41212869 -2.44141912 -2.47070956 -2.81903172 -2.84344053 -2.86784935 -2.89225793 -3.25522542 -3.27475238 -3.29427934 -3.3138063 -3.69141912 -3.70606422 -3.72070956 -3.73535466 -4.12761259 -4.13737631 -4.14713955 -4.15690327 -4.56380653 -4.56868792 -4.57356977 -4.57845163 -1.13366234 -1.51061976 -1.54679286 -0.574404478 -1.30474186 -0.24665603 -0.374044001 -1.4484551 -3.12333345 -4.5980854 -4.60642147 -2.70165992 -2.2775259 -1.85906744 -1.0147953 -3.9519043 -3.53900552 -4.61628008 -0.670115888 -0.284158498 -3.00220513 -2.14383841 -1.7235204 -3.88537741 -3.44182205 -2.56872988 -4.26268864 -0.712482452 -1.41593933 -0.930228829 -4.59511709 -4.30321074 -2.47363377 -4.21093035 -3.33238673 -1.63367176 -1.26279211 -4.19069242 -2.03876448 -2.91058493 -3.74383831 -1.77847886 -4.14435196 -3.55125952 -3.90132046 -3.13849974 -2.22154522 -2.70325208 -1.86679459 -3.80691504 -2.52955413 -2.95434189 -3.38364887 -2.35874343 -1.97019005 -3.19956827 -2.76885724 -3.64361405 -2.18936563 1.10772836 1.50139809 1.52752781 0.57251519 0.276239157 4.43036699 3.12450004 4.59975052 4.6158886 2.70752382 2.2860899 1.86351311 1.44339931 1.0420841 3.54476428 3.98009968 0.655797303 1.29926264 0.288774133 2.56386423 4.26325655 2.9989388 1.71320736 3.43868947 3.88504696 2.13497663 0.500126541 1.93136799 1.40800476 0.853966951 4.59730196 4.65452957 0.262098402 2.48900509 4.22717476 4.22952938 1.6323365 1.19247031 3.33908129 2.06214881 3.76599073 2.91341782 3.6473918 2.75286794 4.1489749 3.1936779 2.33356309 1.82320678 0.848889053 3.56311083 3.13965225 2.28179789 2.71089792 1.77845705 2.51998448 2.95154405 3.92174101 2.11139631 3.38637948 3.81579542];
y   = [-0.589246213 -2.5 -2.5 0.0 0.0 0.589246213 2.5 2.5 0.0 0.0 -2.5 -1.17850661 -0.58926034 1.17850661 0.58926034 2.5 -0.971396983 -1.35354769 -1.73569846 -2.11784935 -2.5 -2.5 -2.5 -2.5 -2.5 -2.5 -2.5 -2.5 -2.5 -2.5 -2.5 -2.0 -1.5 -1.0 -0.5 -0.294623107 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.971396983 1.35354769 1.73569846 2.11784935 2.5 2.5 2.5 2.5 2.5 2.5 2.5 2.5 2.5 2.5 2.5 2.0 1.5 1.0 0.5 0.294623107 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 -0.416666657 -0.833333313 -1.25 -1.66666663 -2.08333325 -2.5 -2.5 -2.5 -2.5 -2.5 -2.5 -2.5 -2.5 -2.5 -2.5 -2.5 -0.883876383 -1.30054343 -1.17850661 -0.883883476 -0.29463017 0.883876383 1.30054343 1.17850661 0.883883476 0.29463017 0.416666657 0.833333313 1.25 1.66666663 2.08333325 2.5 2.5 2.5 2.5 2.5 2.5 2.5 2.5 2.5 2.5 2.5 -0.735698462 -1.17677391 -1.61784923 -2.05892467 -0.5 -1.0 -1.5 -2.0 -0.5 -1.0 -1.5 -2.0 -0.5 -1.0 -1.5 -2.0 -0.5 -1.0 -1.5 -2.0 -0.5 -1.0 -1.5 -2.0 -0.5 -1.0 -1.5 -2.0 -0.5 -1.0 -1.5 -2.0 -0.5 -1.0 -1.5 -2.0 -0.5 -1.0 -1.5 -2.0 -0.5 -1.0 -1.5 -2.0 0.735698462 1.17677391 1.61784923 2.05892467 0.5 1.0 1.5 2.0 0.5 1.0 1.5 2.0 0.5 1.0 1.5 2.0 0.5 1.0 1.5 2.0 0.5 1.0 1.5 2.0 0.5 1.0 1.5 2.0 0.5 1.0 1.5 2.0 0.5 1.0 1.5 2.0 0.5 1.0 1.5 2.0 0.5 1.0 1.5 2.0 -1.47565103 -1.11782455 -0.714545369 -1.53827441 -0.324630409 -1.56034875 -1.92976046 -2.12931013 -2.13781476 -1.02072442 -1.47475016 -2.13803363 -2.13659358 -2.13676596 -2.08957601 -2.13190436 -2.13538146 -1.93556106 -2.17994905 -1.24765849 -0.357531816 -0.347918063 -0.346047431 -0.36675173 -0.362972111 -0.350343496 -0.338252008 -1.88235736 -1.45766461 -1.67562401 -0.562231541 -2.15999866 -1.76384985 -1.26012957 -1.77786648 -1.78099382 -1.76813662 -1.74061191 -1.7655611 -1.77487254 -1.77750552 -1.42010462 -0.77109772 -1.43759704 -1.46617746 -1.42353463 -1.34413183 -1.40160024 -1.04159427 -1.12474799 -1.02821505 -1.05947673 -1.08315086 -0.680835664 -0.682451487 -0.717210233 -0.698935509 -0.737655103 -0.955445647 1.47012246 1.09720409 0.708175659 1.44435406 1.51192522 2.12850857 2.13937473 1.02389729 1.45679307 2.14206147 2.1424911 2.14209342 2.1489625 2.17199588 2.13677096 2.12489152 2.16954088 0.324501574 1.22393453 0.367648154 0.341687083 0.369682878 0.352052629 0.370291024 0.370308757 0.35964179 1.79114676 0.697347462 1.45059526 1.6192764 0.563951015 1.81076205 2.13570595 1.78184235 1.25496435 1.71224225 1.78231204 1.79371142 1.77936089 1.77443564 1.77021182 1.7832315 0.740261257 0.725915015 0.773331404 0.728570461 0.712185144 1.3664031 1.90913427 1.43692243 1.43193388 1.41200924 1.42791891 0.983780265 1.06891811 1.07713664 1.45851815 1.04010725 1.08884573 1.12547386];

IEN = [1 17 117
117 36 1
17 18 118
118 117 17
18 19 119
119 118 18
19 20 120
120 119 19
20 2 21
21 120 20
36 117 121
121 4 36
117 118 122
122 121 117
118 119 123
123 122 118
119 120 124
124 123 119
120 21 22
22 124 120
4 121 125
125 45 4
121 122 126
126 125 121
122 123 127
127 126 122
123 124 128
128 127 123
124 22 23
23 128 124
45 125 129
129 44 45
125 126 130
130 129 125
126 127 131
131 130 126
127 128 132
132 131 127
128 23 24
24 132 128
44 129 133
133 43 44
129 130 134
134 133 129
130 131 135
135 134 130
131 132 136
136 135 131
132 24 25
25 136 132
43 133 137
137 42 43
133 134 138
138 137 133
134 135 139
139 138 134
135 136 140
140 139 135
136 25 26
26 140 136
42 137 141
141 41 42
137 138 142
142 141 137
138 139 143
143 142 138
139 140 144
144 143 139
140 26 27
27 144 140
41 141 145
145 40 41
141 142 146
146 145 141
142 143 147
147 146 142
143 144 148
148 147 143
144 27 28
28 148 144
40 145 149
149 39 40
145 146 150
150 149 145
146 147 151
151 150 146
147 148 152
152 151 147
148 28 29
29 152 148
39 149 153
153 38 39
149 150 154
154 153 149
150 151 155
155 154 150
151 152 156
156 155 151
152 29 30
30 156 152
38 153 157
157 37 38
153 154 158
158 157 153
154 155 159
159 158 154
155 156 160
160 159 155
156 30 31
31 160 156
37 157 35
35 5 37
157 158 34
34 35 157
158 159 33
33 34 158
159 160 32
32 33 159
160 31 3
3 32 160
6 46 161
161 65 6
46 47 162
162 161 46
47 48 163
163 162 47
48 49 164
164 163 48
49 7 50
50 164 49
65 161 165
165 9 65
161 162 166
166 165 161
162 163 167
167 166 162
163 164 168
168 167 163
164 50 51
51 168 164
9 165 169
169 74 9
165 166 170
170 169 165
166 167 171
171 170 166
167 168 172
172 171 167
168 51 52
52 172 168
74 169 173
173 73 74
169 170 174
174 173 169
170 171 175
175 174 170
171 172 176
176 175 171
172 52 53
53 176 172
73 173 177
177 72 73
173 174 178
178 177 173
174 175 179
179 178 174
175 176 180
180 179 175
176 53 54
54 180 176
72 177 181
181 71 72
177 178 182
182 181 177
178 179 183
183 182 178
179 180 184
184 183 179
180 54 55
55 184 180
71 181 185
185 70 71
181 182 186
186 185 181
182 183 187
187 186 182
183 184 188
188 187 183
184 55 56
56 188 184
70 185 189
189 69 70
185 186 190
190 189 185
186 187 191
191 190 186
187 188 192
192 191 187
188 56 57
57 192 188
69 189 193
193 68 69
189 190 194
194 193 189
190 191 195
195 194 190
191 192 196
196 195 191
192 57 58
58 196 192
68 193 197
197 67 68
193 194 198
198 197 193
194 195 199
199 198 194
195 196 200
200 199 195
196 58 59
59 200 196
67 197 201
201 66 67
197 198 202
202 201 197
198 199 203
203 202 198
199 200 204
204 203 199
200 59 60
60 204 200
66 201 64
64 10 66
201 202 63
63 64 201
202 203 62
62 63 202
203 204 61
61 62 203
204 60 8
8 61 204
209 95 74
209 207 13
242 238 215
221 83 213
219 212 88
216 84 85
208 12 92
211 210 208
236 222 80
66 10 75
235 231 66
247 235 214
242 222 236
262 254 257
255 252 251
230 226 71
227 73 72
209 74 73
235 75 76
214 76 77
215 214 77
222 215 78
80 79 11
250 239 244
216 213 84
217 216 85
206 93 94
218 87 212
218 217 86
233 93 206
234 219 232
223 90 211
20 90 2
17 1 91
224 17 91
224 208 210
211 19 210
224 91 12
95 9 74
241 233 240
205 92 93
207 206 94
230 70 225
207 94 13
226 72 71
234 92 205
211 20 19
227 209 73
209 13 95
210 19 18
224 210 18
232 223 211
211 90 20
212 87 88
219 88 89
244 216 237
213 83 84
231 228 67
215 77 78
222 78 79
220 81 82
217 85 86
259 207 227
218 86 87
251 243 246
241 240 212
246 240 233
223 219 89
241 219 234
221 82 83
221 220 82
257 250 256
245 242 220
222 79 80
236 80 81
223 89 90
232 211 208
224 18 17
224 12 208
225 70 69
229 69 68
259 253 207
230 71 70
227 207 209
227 72 226
228 68 67
254 238 249
229 225 69
229 68 228
244 239 213
256 252 255
231 67 66
235 66 75
234 232 208
232 219 223
233 205 93
246 243 240
234 208 92
241 234 205
235 76 214
247 214 238
236 81 220
242 236 220
237 216 217
243 217 218
238 214 215
249 242 245
239 221 213
244 213 216
240 218 212
246 233 206
241 205 233
241 212 219
242 215 222
245 220 221
243 237 217
243 218 240
252 237 251
250 248 239
245 221 239
248 245 239
253 246 206
253 251 246
247 228 231
247 231 235
257 248 250
254 249 248
249 238 242
249 245 248
252 244 237
261 260 256
263 258 255
251 237 243
261 255 258
252 250 244
253 206 207
263 259 258
262 247 254
254 247 238
263 251 253
261 256 255
260 257 256
256 250 252
262 257 260
257 254 248
258 226 230
261 258 230
259 227 226
259 226 258
260 225 229
262 260 229
261 230 225
261 225 260
262 229 228
262 228 247
263 255 251
263 253 259
267 14 97
301 292 300
273 110 111
278 109 270
309 287 306
281 266 15
281 100 45
304 278 302
46 6 96
282 46 96
282 267 268
312 290 293
282 96 14
100 4 45
37 5 101
294 284 37
323 313 322
269 106 107
279 107 108
305 302 270
289 286 43
286 44 43
281 45 44
294 101 102
271 102 103
295 105 269
269 105 106
106 105 16
287 285 40
273 270 110
274 273 111
265 98 99
275 274 112
311 300 292
277 276 114
312 293 301
296 48 290
290 48 268
296 7 49
264 97 98
292 98 265
266 265 99
316 297 315
266 99 15
289 42 283
296 290 280
293 97 264
268 48 47
282 268 47
299 272 295
272 271 103
285 283 41
270 109 110
288 38 284
272 103 104
295 272 104
299 298 272
274 111 112
291 266 286
275 112 113
321 311 317
276 275 113
301 300 276
276 113 114
277 114 115
280 277 115
312 301 277
288 287 39
278 108 109
279 269 107
279 108 278
280 115 116
296 116 7
286 281 44
281 15 100
282 47 46
282 14 267
283 42 41
285 41 40
284 38 37
294 37 101
287 40 39
305 273 297
286 266 281
289 43 42
288 39 38
309 307 285
308 294 271
323 298 320
310 283 307
291 286 289
290 268 267
293 290 267
310 289 283
317 266 291
292 264 98
311 303 300
293 267 97
301 293 264
294 102 271
308 271 298
295 104 105
299 295 269
296 280 116
296 49 48
297 273 274
303 274 275
298 271 272
323 320 313
299 269 279
304 279 278
300 275 276
311 292 265
301 264 292
301 276 277
302 278 270
305 270 273
303 297 274
303 275 300
320 299 304
304 299 279
318 316 315
322 319 309
306 287 288
308 306 288
307 283 285
309 285 287
308 288 284
308 284 294
323 322 306
314 313 302
319 318 307
310 291 289
317 265 266
321 310 318
312 277 280
312 280 290
313 304 302
314 302 305
316 305 297
322 314 319
315 297 303
315 303 311
319 316 318
316 314 305
317 311 265
321 291 310
321 318 315
318 310 307
319 307 309
319 314 316
320 298 299
320 304 313
321 315 311
321 317 291
322 309 306
322 313 314
323 306 308
323 308 298
]';

% function to plot the mesh
plotmesh;
